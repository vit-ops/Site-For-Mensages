<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZapZap</title>
  <link rel="icon" href="Zap.png">
  <style>
    html,body { height:100%; margin:0; font-family: Arial, sans-serif; background:#f3f4f6; }
    body { display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top: 20px; }
    .card {
      background:#fff;
      padding:18px;
      border-radius:10px;
      box-shadow:0 8px 24px rgba(0,0,0,0.08);
      width:320px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:stretch;
    }
    input { padding:10px 12px; border-radius:8px; border:1px solid #e5e7eb; font-size:15px; width:100%; box-sizing:border-box; }
    button { padding:10px; border-radius:8px; border:none; background:#2563eb; color:white; cursor:pointer; font-weight:600; }
    .muted { font-size:13px; color:#6b7280; text-align:center; }

    #greeting {
      font-size: 24px;
      text-align: center;
      margin-top: 0;
      padding: 20px;
      color: #2563eb;
    }
  </style>
</head>
<body>
  <!-- Exibindo o nome do usuário e uma saudação -->
  <h2 id="greeting" style="display:none;"></h2>

  <div class="card" id="card">
    <input id="username" type="text" placeholder="Nome de usuário" autocomplete="username" />
    <button id="checkBtn">Verificar usuário</button>
    <!-- campo de senha fica oculto até confirmarmos que o usuário existe -->
    <input id="password" type="text" placeholder="Senha" style="display:none" autocomplete="current-password" />
    <button id="loginBtn" style="display:none">Entrar</button>
    <div class="muted" id="msg"></div>
  </div>

  <script type="module">

    const firebaseConfig = {
      apiKey: "AIzaSyCeeMB1oKxVOu3oUJNcsnwRiy1Tq0tD0cc",
      authDomain: "zapzap-af2ac.firebaseapp.com",
      projectId: "zapzap-af2ac",
      storageBucket: "zapzap-af2ac.firebasestorage.app",
      messagingSenderId: "80406115977",
      appId: "1:80406115977:web:aa5b44dea71ce1dccdb858"
    };


    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const usernameEl = document.getElementById('username');
    const checkBtn = document.getElementById('checkBtn');
    const passwordEl = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const msgEl = document.getElementById('msg');
    const cardEl = document.getElementById('card');
    const greetingEl = document.getElementById('greeting');

    let matchedUserDoc = null;

    function setMsg(text, isError = false) {
      msgEl.textContent = text;
      msgEl.style.color = isError ? '#b91c1c' : '#064e3b';
    }


    checkBtn.addEventListener('click', async () => {
      const name = usernameEl.value.trim();
      if (!name) { setMsg('Informe o nome de usuário.', true); return; }

      setMsg('Procurando usuário...');
      checkBtn.disabled = true;

      try {
        const usersCol = collection(db, 'users');
        const q = query(usersCol, where('name', '==', name));
        const snap = await getDocs(q);

        if (snap.empty) {

          setMsg('Usuário não encontrado. Redirecionando...', false);

          setTimeout(() => { window.location.href = 'index2.html'; }, 600);
          return;
        }

        const docSnap = snap.docs[0];
        matchedUserDoc = docSnap.data();
        const usuarioId = matchedUserDoc.name;


        usernameEl.style.display = 'none';
        checkBtn.style.display = 'none';

        document.title = `${matchedUserDoc.name}`;
        greetingEl.textContent = `${matchedUserDoc.name}!`;
        greetingEl.style.display = 'block';


        passwordEl.style.display = 'block';
        loginBtn.style.display = 'block';
        setMsg('Usuário encontrado. Informe a senha.');

        passwordEl.focus();
      } catch (err) {
        console.error('Erro ao consultar Firestore:', err);
        setMsg('Erro ao verificar usuário. Veja console.', true);
      } finally {
        checkBtn.disabled = false;
      }
    });


    loginBtn.addEventListener('click', () => {
      if (!matchedUserDoc) { setMsg('Primeiro verifique o usuário.', true); return; }
      const typed = passwordEl.value;
      if (!typed) { setMsg('Informe a senha.', true); return; }
      if (typed === matchedUserDoc.senha) {
        setMsg('Senha correta — logado com sucesso.');
        window.location.href = `index3.html?usuarioId=${matchedUserDoc.name}`;
      } else {
        setMsg('Senha incorreta.', true);
      }
    });


    usernameEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkBtn.click(); });
    passwordEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') loginBtn.click(); });
  </script>
</body>
</html>
